<corto xmlns:corto="http://corto.io/packages/driver/fmt/xml">
    <corto:package name="corto/script/ast" url="http://corto.io/doc/corto">
        <corto:object name="Visitor" type="class"/>
        <corto:object name="Initializer" type="class"/>
        <corto:object name="Scope" type="class"/>
        <corto:object name="InitializerHelper" type="class"/>
        <corto:object name="Storage" type="class"/>
        <corto:object name="Expression" type="class"/>

        <class name="Node">
            <corto:scope>
                <member name="data" type="map{string,object}" modifiers="private"/>
                <method name="getData(string key)" returnType="object"/>
                <method name="setData(string key,object value)"/>
                <overridable name="visit(Visitor visitor)" returnType="int16"/>
            </corto:scope>
        </class>

        <class name="Statement" base="Node"/>

        <class name="FunctionArgument" base="Node">
            <corto:scope>
                <member name="name" type="lang/string"/>
                <member name="type" type="script/ast/Storage"/>
            </corto:scope>
        </class>

        <class name="DeclarationIdentifier" base="Node" baseAccess="hidden">
            <corto:scope>
                <member name="ids" type="list{script/ast/Storage}" modifiers="not_null"/>
                <member name="arguments" type="list{FunctionArgument}"  modifiers="not_null"/>
            </corto:scope>
        </class>

        <class name="Declaration" base="Statement" baseAccess="hidden">
            <corto:scope>
                <member name="type" type="script/ast/Storage"/>
                <member name="id" type="DeclarationIdentifier"/>
                <member name="isVar" type="lang/bool"/>
                <member name="initializer" type="script/ast/Initializer"/>
                <member name="scope" type="script/ast/Scope"/>
            </corto:scope>
        </class>

        <class name="FunctionDeclaration" base="Declaration">
            <corto:scope>
                <member name="returnsReference" type="lang/bool"/>
                <member name="parameters" type="list{Declaration}" modifiers="not_null"/>
            </corto:scope>
        </class>

        <class name="Expression" base="Statement">
            <corto:scope>
                <member name="is_reference" type="bool" modifiers="readonly"/>
                <member name="type" type="lang/type" modifiers="private"/>
                <method name="setType(lang/type type)"/>
                <method name="getType()" returnType="lang/type"/>
                <method name="getTypeForTarget(lang/type target,ast/Expression target_expr)" returnType="lang/type"/>
                <method name="serialize(lang/type target,word ptr)" returnType="int16"/>
                <overridable name="getPtr()" returnType="lang/word"/>
                <overridable name="fold()" returnType="Expression"/>
            </corto:scope>
        </class>

        <class name="Unary" base="Expression" baseAccess="hidden">
            <corto:scope>
                <member name="expr" type="Expression"/>
                <member name="operator" type="operatorKind"/>
                <member name="postfix" type="bool"/>
                <override name="fold()" returnType="Expression"/>
            </corto:scope>
        </class>

        <class name="Binary" base="Expression" baseAccess="hidden">
            <corto:scope>
                <member name="left" type="Expression"/>
                <member name="right" type="Expression"/>
                <member name="operator" type="operatorKind"/>
                <member name="operand_type" type="lang/type" modifiers="readonly"/>
                <method name="construct()" returnType="int16"/>
                <override name="fold()" returnType="Expression"/>
            </corto:scope>
        </class>

        <class name="Ternary" base="Expression" baseAccess="hidden">
            <corto:scope>
                <member name="cond" type="Expression"/>
                <member name="true" type="Expression"/>
                <member name="false" type="Expression"/>
                <override name="fold()" returnType="Expression"/>
            </corto:scope>
        </class>

        <class name="Cast" base="Expression" baseAccess="hidden">
            <corto:scope>
                <member name="type" type="script/ast/Storage"/>
                <member name="expr" type="Expression"/>
            </corto:scope>
        </class>

        <class name="InitializerValue" base="Node" baseAccess="hidden">
            <corto:scope>
                <member name="key" type="string"/>
                <member name="value" type="Expression"/>
            </corto:scope>
        </class>

        <class name="Initializer" base="Expression" baseAccess="hidden">
            <corto:scope>
                <member name="collection" type="bool"/>
                <member name="values" type="list{script/ast/InitializerValue}" modifiers="not_null"/>
                <method name="apply(InitializerHelper helper)" returnType="int16"/>
                <method name="visit_values(Visitor visitor,InitializerHelper helper)" returnType="int16"/>
                <overridable name="visit(Visitor visitor)" returnType="int16"/>
                <override name="fold()" returnType="Expression"/>
            </corto:scope>
        </class>

        <class name="Storage" base="Expression">
            <corto:scope>
                <member name="value" type="word" modifiers="local"/>
                <method name="set_object(object obj)"/>
                <method name="get_object()" returnType="object"/>
                <overridable name="getPtr()" returnType="lang/word"/>
            </corto:scope>
        </class>

        <class name="Identifier" base="Storage">
            <corto:scope>
                <member name="id" type="string"/>
            </corto:scope>
        </class>

        <class name="StorageInitializer" base="Storage">
            <corto:scope>
                <member name="expr" type="Storage"/>
                <member name="initializer" type="script/ast/Initializer"/>
            </corto:scope>
        </class>

        <class name="Member" base="Storage" baseAccess="hidden">
            <corto:scope>
                <member name="expr" type="Storage"/>
                <member name="key" type="string"/>
                <member name="member" type="lang/member" modifiers="hidden"/>
            </corto:scope>
        </class>

        <class name="Literal" base="Expression" baseAccess="hidden"/>

        <class name="Number" base="Literal" baseAccess="hidden">
            <corto:scope>
                <member name="unit" type="string"/>
            </corto:scope>
        </class>

        <class name="Boolean" base="Literal" baseAccess="hidden">
            <corto:scope>
                <member name="value" type="bool"/>
                <method name="init()" returnType="int16"/>
                <override name="getPtr()" returnType="lang/word"/>
            </corto:scope>
        </class>

        <class name="Character" base="Literal" baseAccess="hidden">
            <corto:scope>
                <member name="value" type="char"/>
                <method name="init()" returnType="int16"/>
                <override name="getPtr()" returnType="lang/word"/>
            </corto:scope>
        </class>

        <class name="Integer" base="Number">
            <corto:scope>
                <member name="value" type="uint64"/>
                <method name="init()" returnType="int16"/>
                <override name="getPtr()" returnType="lang/word"/>
            </corto:scope>
        </class>

        <class name="SignedInteger" base="Number">
            <corto:scope>
                <member name="value" type="int64"/>
                <method name="init()" returnType="int16"/>
                <override name="getPtr()" returnType="lang/word"/>
            </corto:scope>
        </class>

        <class name="FloatingPoint" base="Number">
            <corto:scope>
                <member name="value" type="float64"/>
                <method name="init()" returnType="int16"/>
                <override name="getPtr()" returnType="lang/word"/>
            </corto:scope>
        </class>

        <class name="String" base="Literal" baseAccess="readonly">
            <corto:scope>
                <member name="value" type="string"/>
                <member name="delim" type="char"/>
                <method name="init()" returnType="int16"/>
                <override name="getPtr()" returnType="lang/word"/>
            </corto:scope>
        </class>

        <class name="Null" base="Literal" baseAccess="hidden"/>

        <class name="Scope" base="Node">
            <corto:scope>
                <member name="parent" type="Scope"/>
                <member name="default_type" type="Storage"/>
                <member name="statements" type="list{script/ast/Statement}" modifiers="readonly|not_null"/>
                <method name="addStatement(Statement node)"/>
                <overridable name="visit(Visitor visitor)" returnType="int16"/>
            </corto:scope>
        </class>

        <enum name="InitializerKind">
            <corto:scope>
                <constant name="InitStatic"/>
                <constant name="InitDynamic"/>
                <constant name="InitExpression"/>
            </corto:scope>
        </enum>

        <struct name="InitializerFrame">
            <corto:scope>
                <member name="location" type="uint32"/>
                <member name="type" type="type"/>
                <member name="isKey" type="bool"/>
                <member name="member" type="member"/>
                <member name="offset" type="word"/>
            </corto:scope>
        </struct>

        <class name="InitializerHelper">
            <corto:scope>
                <member name="expression" type="ast/Expression"/>
                <member name="frames" type="array{InitializerFrame,64}" modifiers="private|local"/>
                <member name="fp" type="uint8" modifiers="private|local"/>
                <method name="construct()" returnType="int16"/>
                <method name="currentType()" returnType="type"/>
                <method name="type()" returnType="type"/>
                <overridable name="push()" returnType="int16"/>
                <overridable name="pop()" returnType="int8"/>
                <overridable name="value(ast/Expression v)" returnType="int16"/>
                <overridable name="member(string name)" returnType="int32"/>
                <overridable name="pushKey()" returnType="int16"/>
                <overridable name="popKey()" returnType="int16"/>
                <overridable name="valueKey(ast/Expression key)" returnType="int16"/>
                <overridable name="define_object()" returnType="int16"/>
                <overridable name="next()" returnType="int16"/>
                <method name="initFrame()" returnType="uint16"/>
            </corto:scope>
        </class>

        <struct name="StaticInitializerHelperFrame">
            <corto:scope>
                <member name="ptr" type="word"/>
                <member name="keyPtr" type="word"/>
            </corto:scope>
        </struct>

        <class name="StaticInitializerHelper" base="InitializerHelper">
            <corto:scope>
                <member name="frames" type="array{StaticInitializerHelperFrame,64}" modifiers="private|local"/>
                <method name="construct()" returnType="int16"/>
                <method name="push()" returnType="int16"/>
                <method name="value(ast/Expression v)" returnType="int16"/>
                <method name="define_object()" returnType="int16"/>
            </corto:scope>
        </class>

        <class name="Visitor">
            <corto:scope>
                <method name="visit(Node node)" returnType="int16"/>
                <overridable name="visitScope(Scope node)" returnType="int16"/>
                <overridable name="visitStatement(Statement node)" returnType="int16"/>
                <overridable name="visitDeclaration(Declaration node)" returnType="int16"/>
                <overridable name="visitExpression(Expression node)" returnType="int16"/>
                <overridable name="visitBinary(ast/Binary node)" returnType="int16"/>
                <overridable name="visitStorage(script/ast/Storage node)" returnType="int16"/>
                <overridable name="visitInitializer(script/ast/Initializer node)" returnType="int16"/>
            </corto:scope>
        </class>

    </corto:package>
</corto>
